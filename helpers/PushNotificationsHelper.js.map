{"version":3,"sources":["../../src/helpers/PushNotificationsHelper.js"],"names":["title","body","userId","actionUrl","admin","database","ref","once","then","token","val","userNotifiToken","console","log","uri","method","headers","serverKeyFirebase","json","icon","click_action","clientUrl","sentNotification","sendNotificationToUser"],"mappings":";;;;;;;;uEAOO,iBAAsCA,KAAtC,EAA6CC,IAA7C,EAAmDC,MAAnD,EAA2DC,SAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACyBC,MAAMC,QAAN,GAAiBC,GAAjB,iBAAmCJ,MAAnC,EACiBK,IADjB,CACsB,OADtB,EAEiBC,IAFjB,CAEsB;AAAA,mCAASC,MAAMC,GAAN,EAAT;AAAA,yBAFtB,CADzB;;AAAA;AACCC,uCADD;;AAIHC,gCAAQC,GAAR,CAAY,eAAZ,EAA6BF,eAA7B;;AAJG,6BAMAA,eANA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,+BAQkC,8BACzB;AACIG,iCAAK,qCADT;AAEIC,oCAAQ,MAFZ;AAGIC,qCAAS,EAAE,iBAAiB,SAAS,iBAAOC,iBAAnC,EAHb;AAIIC,kCAAM;AACF,gDAAgB;AACZlB,gDADY;AAEZC,8CAFY;AAGZkB,0CAAM,yDAHM;AAIZC,kDAAkB,iBAAOC,SAAzB,SAAsClB;AAJ1B,iCADd;AAOF,sCAAMQ;AAPJ;AAJV,yBADyB,CARlC;;AAAA;AAQSW,wCART;;AAwBK,4BAAGA,gBAAH,EACIV,QAAQC,GAAR,CAAY,cAAZ,EADJ,KAGID,QAAQC,GAAR,CAAY,kBAAZ;AA3BT;AAAA;;AAAA;AAAA;AAAA;;AA6BKD,gCAAQC,GAAR;;AA7BL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeU,sB;;;;;AAPtB;;;;AACA;;;;AACA;;IAAYnB,K;;AACZ;;;;AACA","file":"PushNotificationsHelper.js","sourcesContent":["import User from \"../models/user.model\";\nimport mongoose from \"mongoose\" ;\nimport * as admin from \"firebase-admin\";\nimport request from 'request-promise';\nimport config from '../config';\n\n\nexport async function sendNotificationToUser(title, body, userId, actionUrl) {\n    let userNotifiToken = await admin.database().ref(`/fcmTokens/${userId}`)\n                                                .once('value')\n                                                .then(token => token.val());\n    console.log(\"USER TOKEN : \", userNotifiToken);\n\n    if(userNotifiToken) {\n        try{ \n            let sentNotification = await request(\n                {\n                    uri: 'https://fcm.googleapis.com/fcm/send',\n                    method: 'POST',\n                    headers: { 'Authorization': 'key=' + config.serverKeyFirebase },\n                    json: {\n                        \"notification\": {\n                            title,\n                            body,\n                            icon: 'https://image.flaticon.com/icons/png/128/148/148921.png',\n                            click_action : `${config.clientUrl}/${actionUrl}`\n                        },\n                        \"to\": userNotifiToken\n                    }\n                }\n            );\n            if(sentNotification)\n                console.log(\"Message Sent\");\n            else\n                console.log(\"Message Not Sent\");\n        } catch(err) {\n            console.log(err);   \n        }  \n    } \n}\n"]}