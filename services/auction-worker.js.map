{"version":3,"sources":["../../src/services/auction-worker.js"],"names":["start","scheduleJob","auctions","find","finished","auction","endDate","Date","findOne","relatedAuction","id","sort","price","limit","auctionOffer","console","log","_id","winned","save"],"mappings":";;;;;QAMgBA,K,GAAAA,K;;AANhB;;;;AAEA;;;;AACA;;;;;;;;AAGO,SAASA,KAAT,GAAiB;AAAA;;AAEhB,+BAASC,WAAT,CAAqB,aAArB,0DAAoC;AAAA;AAAA;AAAA;AAAA;AAAA;AACxBC,wDADwB,GACb,kBAAQC,IAAR,CAAa,EAAEC,UAAS,KAAX,EAAb,CADa;AAAA,sFAGTF,QAHS;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAGpBG,uDAHoB;AAKhBC,uDALgB,GAKND,QAAQC,OALF;;AAAA,sDAOjB,IAAIC,IAAJ,KAAaD,OAPI;AAAA;AAAA;AAAA;;AAAA;AAAA,uDAQa,uBAAaE,OAAb,CAAqB,EAAEC,gBAAgBJ,QAAQK,EAA1B,EAArB,EAAqDC,IAArD,CAA0D,EAAEC,OAAO,CAAC,CAAV,EAA1D,EAAyEC,KAAzE,CAA+E,CAA/E,CARb;;AAAA;AAQRC,4DARQ;;;AAUZC,wDAAQC,GAAR,CAAYF,YAAZ;;AAEA,oDAAGA,YAAH,EAAgB;AACRT,gEAAQS,YAAR,GAAuBA,aAAaG,GAApC;AACAH,qEAAaI,MAAb,GAAsB,IAAtB;AACP;AACDb,wDAAQD,QAAR,GAAmB,IAAnB;;AAEAU,6DAAaK,IAAb;AACAd,wDAAQc,IAAR;;AAnBY;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAApC;AAwBP","file":"auction-worker.js","sourcesContent":["import schedule from \"node-schedule\" ;\n\nimport Auction from \"../models/auction.model\";\nimport AuctionOffer from \"../models/auction-offer.model\";\n\n\nexport function start() {\n        \n        schedule.scheduleJob('0 0 0 * * *', async () => {\n                let auctions = Auction.find({ finished:false }) ;\n                \n                for(let auction in auctions){\n                 \n                        let endDate = auction.endDate ;\n                \n                        if(new Date() > endDate){\n                                let auctionOffer = await AuctionOffer.findOne({ relatedAuction: auction.id }).sort({ price: -1 }).limit(1)\n                                \n                                console.log(auctionOffer) ;\n                                \n                                if(auctionOffer){\n                                        auction.auctionOffer = auctionOffer._id\n                                        auctionOffer.winned = true;                                        \n                                }\n                                auction.finished = true;\n                                \n                                auctionOffer.save();\n                                auction.save() ;\n                        }\n                }           \n        });\n\n}"]}