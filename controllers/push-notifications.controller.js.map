{"version":3,"sources":["../../src/controllers/push-notifications.controller.js"],"names":["admin","subscribe","req","res","next","token","body","NotFound","database","ref","child","user","id","set","status","end","unsubscribe","remove"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;AACA;;AACA;;IAAYA,K;;;;;;;;kBAEG;AACLC,aADK,qBACKC,GADL,EACUC,GADV,EACeC,IADf,EACqB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACtBC,iCADsB,GACZH,IAAII,IADQ,CACtBD,KADsB;;AAAA,gCAExBA,KAFwB;AAAA;AAAA;AAAA;;AAAA,6DAGjBD,KAAK,IAAI,mBAASG,QAAb,CAAsB,OAAtB,CAAL,CAHiB;;AAAA;AAAA;AAAA;AAAA,mCAMlBP,MAAMQ,QAAN,GAAiBC,GAAjB,CAAqB,WAArB,EAAkCC,KAAlC,CAAwCR,IAAIS,IAAJ,CAASC,EAAjD,EAAqDC,GAArD,CAAyDR,KAAzD,CANkB;;AAAA;AAOxBF,gCAAIW,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AAPwB;AAAA;;AAAA;AAAA;AAAA;;AASxBX;;AATwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAW/B,KAZU;AAeLY,eAfK,uBAeOd,GAfP,EAeYC,GAfZ,EAeiBC,IAfjB,EAeuB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAEpBJ,MAAMQ,QAAN,GAAiBC,GAAjB,CAAqB,eAAeP,IAAIS,IAAJ,CAASC,EAA7C,EAAkDK,MAAlD,EAFoB;;AAAA;AAG1Bf,gCAAIY,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AAH0B;AAAA;;AAAA;AAAA;AAAA;;AAK1BX;;AAL0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOjC;AAtBU,C","file":"push-notifications.controller.js","sourcesContent":["import User from \"../models/user.model\";\nimport OfferMessageNotification from \"../models/offer-message-notification.model\";\nimport { ApiResponse2 } from \"../helpers/ApiResponse\";\nimport ApiError from \"../helpers/ApiError\";\nimport { isUserNotExist } from \"../helpers/CheckMethods\";\nimport { sendNotificationToUser } from '../helpers/PushNotificationsHelper';\nimport * as admin from \"firebase-admin\";\n\nexport default {\n    async subscribe(req, res, next) {\n        let { token } = req.body;\n        if(!token)\n            return next(new ApiError.NotFound('Token'));\n        \n        try {\n            await admin.database().ref('fcmTokens').child(req.user.id).set(token);\n            res.status(204).end();\n        } catch(err) {\n            next(err);\n        }    \n    },\n\n\n    async unsubscribe(req, res, next) {\n        try{\n            await admin.database().ref('fcmTokens/' + req.user.id ).remove()\n            req.status(204).end();\n        } catch(err) {\n            next(err);\n        }\n    }\n}\n\n"]}